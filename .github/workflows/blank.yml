name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions üöÄ
on: 
  push:
    branches:
      - main
    
      
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v3

      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "üçè This job's status is ${{ job.status }}."
      
  build:
    runs-on: ubuntu-latest
    environment: developer
    steps:
      # Checkout the Source code from the latest commit
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
          
      
      # Install the SFDX CLI 
      - name: Install the SFDX CLI
        run: |
                    - export CLIURL=https://developer.salesforce.com/media/salesforce-cli/sfdx-linux-amd64.tar.xz  
                    - export SFDX_AUTOUPDATE_DISABLE=false
                    - export SFDX_USE_GENERIC_UNIX_KEYCHAIN=true
                    - export SFDX_DOMAIN_RETRY=300
                    - export SFDX_DISABLE_APP_HUB=true
                    - export SFDX_LOG_LEVEL=DEBUG
                    - export ROOTDIR=src/
                    #Create sfdx directory
                    - mkdir sfdx
                    #Install Salesforce CLI
                    - wget -qO- $CLIURL | tar xJ -C sfdx --strip-components 1
                    - "./sfdx/install"
                    - export PATH=./sfdx/$(pwd):$PATH
                    - sfdx auth:jwt:grant -u prabhatjha25@gmail.com -i 3MVG9ZL0ppGP5UrAGmwExlELn2uWLTQfoq23TAfP9nWuc_wTJr7iLFrqpqGCX.V29c0SG2XQGppuukBGn3iVB -f server.key
      
      - name: Authenticate Salesforce ORG
        run: |
          sfdx auth:jwt:grant -u prabhatjha25@gmail.com -i 3MVG9ZL0ppGP5UrAGmwExlELn2uWLTQfoq23TAfP9nWuc_wTJr7iLFrqpqGCX.V29c0SG2XQGppuukBGn3iVB -f server.key
      
      - name: Validate Source Code Against Salesforce ORG
        run: |
          sfdx force:source:deploy -p force-app -c -u HubOrg
